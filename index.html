<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú–∞–≥–∞–∑–∏–Ω</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    body {
      background: #f0f0f0;
      color: #000;
      padding: 16px;
      min-height: 100vh;
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .product {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .product h3 {
      margin-bottom: 8px;
    }
    .availability {
      color: #2e8b57;
      font-weight: bold;
      margin: 8px 0;
    }
    .out-of-stock {
      color: #cc0000;
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 8px;
    }
    .add-btn {
      background: #0088cc;
      color: white;
      width: 100%;
    }
    .cart-btn {
      background: #ff6f00;
      color: white;
      width: 100%;
    }
    .back-btn {
      background: #666;
      color: white;
      width: 100%;
    }
    .cart-item {
      background: white;
      padding: 12px;
      border-radius: 8px;
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
    }
    .confirm-btn {
      background: #2e8b57;
      color: white;
      width: 100%;
      margin-top: 16px;
    }
    h2 {
      margin: 16px 0;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="catalog">
      <div class="header">
        <h2>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</h2>
        <button class="cart-btn" id="showCart">–ö–æ—Ä–∑–∏–Ω–∞</button>
      </div>
      <div class="product">
        <h3>üì± iPhone 15 Pro Max 256 –ì–ë</h3>
        <p>–¶–≤–µ—Ç: –¢–∏—Ç–∞–Ω, 256 –ì–ë –ø–∞–º—è—Ç–∏</p>
        <div class="availability">–í –Ω–∞–ª–∏—á–∏–∏ ‚úÖ</div>
        <button class="add-btn" data-id="iphone15pm256">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
      </div>
      <!-- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã –∑–¥–µ—Å—å -->
    </div>

    <div id="cart" style="display:none;">
      <div class="header">
        <h2>üõí –ö–æ—Ä–∑–∏–Ω–∞</h2>
        <button class="back-btn" id="backToCatalog">‚Üê –ù–∞–∑–∞–¥</button>
      </div>
      <div id="cartItems">
        <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
      </div>
      <div id="emptyCart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
      <button class="confirm-btn" id="confirmOrder" style="display:none;">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
  </div>

  <script>
    const WebApp = window.Telegram.WebApp;
    WebApp.expand();
    WebApp.ready();

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
    let cart = JSON.parse(localStorage.getItem('cart')) || {};

    // DOM
    const catalog = document.getElementById('catalog');
    const cartView = document.getElementById('cart');
    const cartItems = document.getElementById('cartItems');
    const emptyCart = document.getElementById('emptyCart');
    const confirmBtn = document.getElementById('confirmOrder');

    // –¢–æ–≤–∞—Ä—ã (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å)
    const products = {
      iphone15pm256: {
        name: "iPhone 15 Pro Max 256 –ì–ë",
        price: "120000 —Ä—É–±.",
        inStock: true
      }
    };

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
    function updateCartUI() {
      let totalItems = 0;
      cartItems.innerHTML = '';
      for (const id in cart) {
        if (cart[id] > 0) {
          const product = products[id];
          if (product) {
            totalItems += cart[id];
            const item = document.createElement('div');
            item.className = 'cart-item';
            item.innerHTML = `
              <div>${product.name} √ó ${cart[id]}</div>
              <div>${product.price}</div>
            `;
            cartItems.appendChild(item);
          }
        }
      }

      if (totalItems === 0) {
        emptyCart.style.display = 'block';
        confirmBtn.style.display = 'none';
      } else {
        emptyCart.style.display = 'none';
        confirmBtn.style.display = 'block';
      }

      localStorage.setItem('cart', JSON.stringify(cart));
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    document.getElementById('showCart').onclick = () => {
      catalog.style.display = 'none';
      cartView.style.display = 'block';
      updateCartUI();
    };

    document.getElementById('backToCatalog').onclick = () => {
      cartView.style.display = 'none';
      catalog.style.display = 'block';
    };

    document.querySelectorAll('.add-btn').forEach(btn => {
      btn.onclick = () => {
        const id = btn.dataset.id;
        cart[id] = (cart[id] || 0) + 1;
        alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
      };
    });

    document.getElementById('confirmOrder').onclick = () => {
      const order = {
        type: "new_order",
        items: [],
        total_items: 0
      };

      for (const id in cart) {
        if (cart[id] > 0) {
          order.items.push({
            product_id: id,
            name: products[id].name,
            quantity: cart[id]
          });
          order.total_items += cart[id];
        }
      }

      // –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
      cart = {};
      localStorage.removeItem('cart');

      // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
      WebApp.sendData(JSON.stringify(order));
      WebApp.close();
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateCartUI();
  </script>
</body>
</html>
